<div class="container py-5" style="background: linear-gradient(to bottom right, #f0f8ff, #e0f7fa); border-radius: 1rem;">
  <div class="text-center mb-4">
    <h1 class="fw-bold text-info display-5">🗂️ Gestor de Tareas</h1>
    <button class="btn btn-info px-4 py-2 mt-3 shadow" (click)="showModal()" data-bs-toggle="modal" data-bs-target="#taskModal">
      ➕ Añadir Tarea
    </button>
  </div>

  <div class="row">
    @for (tarea of toDo; track tarea.id) {
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card h-100 border-0 shadow-sm" [ngClass]="tarea.estado ? 'bg-light-success' : 'bg-light-danger'">
        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <h4 class="card-title text-dark-emphasis fw-bold">{{ tarea.title }}</h4>
            <p class="card-text text-body-secondary">{{ tarea.description }}</p>
          </div>
          <div class="mt-3">
            <div class="d-flex justify-content-between flex-wrap mb-2">
              <span class="badge bg-gradient bg-primary-subtle text-dark">📅 {{ tarea.dueDate | date:'mediumDate' }}</span>
              <span class="badge bg-warning text-dark">🔥 {{ getPriorityLabel(tarea.priority) }}</span>
            </div>
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
              <span class="badge rounded-pill" [ngClass]="tarea.estado ? 'bg-success' : 'bg-danger'">
                {{ tarea.estado ? '✅ Hecha' : '⏳ Pendiente' }}
              </span>
              <div class="btn-group mt-2" role="group">
                <button class="btn btn-sm btn-outline-success" [disabled]="tarea.estado" (click)="endToDo(tarea, tarea.id)">✔️</button>
                <button class="btn btn-sm btn-outline-warning" (click)="edit(tarea.id)">✏️</button>
                <button class="btn btn-sm btn-outline-danger" (click)="confirmDelete() && delete(tarea.id)">🗑️</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal de edición -->
      <div *ngIf="taskEditingId === tarea.id" class="modal d-block" style="background-color: rgba(0,0,0,0.6)">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <form (ngSubmit)="update(tarea, tarea.id)">
              <div class="modal-header bg-warning-subtle">
                <h5 class="modal-title">✏️ Editar Tarea</h5>
                <button type="button" class="btn-close" (click)="closeEditModal()"></button>
              </div>
              <div class="modal-body row g-3">
                <div class="col-12">
                  <label class="form-label">Título</label>
                  <input type="text" class="form-control" [(ngModel)]="tarea.title" name="titleEdit" required>
                </div>
                <div class="col-12">
                  <label class="form-label">Descripción</label>
                  <input type="text" class="form-control" [(ngModel)]="tarea.description" name="descriptionEdit" required>
                </div>
                <div class="col-6">
                  <label class="form-label">Prioridad</label>
                  <select class="form-select" [(ngModel)]="tarea.priority" name="priorityEdit">
                    <option value="1">Baja</option>
                    <option value="2">Media</option>
                    <option value="3">Normal</option>
                    <option value="4">Alta</option>
                    <option value="5">Muy alta</option>
                  </select>
                </div>
                <div class="col-6">
                  <label class="form-label">Fecha Límite</label>
                  <input type="date" class="form-control" [(ngModel)]="tarea.dueDate" name="dueDateEdit" required>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">💾 Guardar Cambios</button>
                <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</div>

<!-- Modal para nueva tarea -->
<div *ngIf="modal" class="modal d-block" style="background-color: rgba(0,0,0,0.6)">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form (ngSubmit)="create()">
        <div class="modal-header bg-info-subtle">
          <h5 class="modal-title">📝 Crear Nueva Tarea</h5>
          <button type="button" class="btn-close" (click)="showModal()"></button>
        </div>
        <div class="modal-body row g-3">
          <div class="col-12">
            <label class="form-label">Título</label>
            <input type="text" class="form-control" [(ngModel)]="newToDo.title" name="title" required>
          </div>
          <div class="col-12">
            <label class="form-label">Descripción</label>
            <input type="text" class="form-control" [(ngModel)]="newToDo.description" name="description" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Prioridad</label>
            <select class="form-select" [(ngModel)]="newToDo.priority" name="priority">
              <option value="1">Baja</option>
              <option value="2">Media</option>
              <option value="3">Normal</option>
              <option value="4">Alta</option>
              <option value="5">Muy alta</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Fecha Límite</label>
            <input type="date" class="form-control" [(ngModel)]="newToDo.dueDate" name="dueDate" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">📌 Guardar</button>
          <button type="button" class="btn btn-secondary" (click)="showModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>
